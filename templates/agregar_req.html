<!doctype html>
<html lang="en">

<head>
    <br>
    <br>
    <title>Agregar Requisición</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />

    <style>
        table input,
        table textarea {
            width: 100%;
        }

        .descripcion-col {
            width: 10%;
        }

        .area-col,
        .usuario-col {
            width: 12%;
        }

        .small-col {
            width: 12%;
        }

        .proceso-col {
            width: 12%;
        }

        .id-col {
            width: 10%;
        }

        .spacer {
            margin-right: 20px;
        }

        .table-container {
            margin-right: 20px;
            flex: 0 0 80%;
        }

        .info-container {
            flex: 0 0 18%;
        }

        .row {
            display: flex;
        }

        .oc {
            width: 5%;
        }

        .remove-btn {
            text-align: center;
        }
    </style>
    <h3 class="text-center mb-4">Agregar Requisición</h3>
</head>

<body>
    <div class="container mt-5">
        <!-- Formulario para agregar requisición -->
        <form action="{{ url_for('guardar_req') }}" method="post">

            <!-- Sección principal de datos de la requisición -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <label for="id_requisicion" class="form-label">ID Requisición</label>
                    <input type="text" class="form-control" id="id_requisicion" name="id_requisicion" required>
                </div>
                <div class="col-md-3">
                    <label for="fecha_solicitud" class="form-label">Fecha de Solicitud</label>
                    <input type="date" class="form-control" id="fecha_solicitud" name="fecha_solicitud" required>
                </div>
                <div class="col-md-3">
                    <label for="solicitante" class="form-label">Solicitante</label>
                    <input type="text" class="form-control" id="solicitante" name="solicitante" required>
                </div>
                <div class="col-md-3">
                    <label for="descripcion_general" class="form-label">Descripción</label>
                    <input type="text" class="form-control" id="descripcion_general" name="descripcion_general" required>
                </div>
            </div>

            <!-- Tabla para ingresar los ítems de la requisición -->
            <div class="row">
                <div class="table-container">
                    <table class="table table-bordered" id="requisicionTable">
                        <thead>
                            <tr>
                                <th class="id-col">Línea</th>
                                <th class="small-col">Descripción</th>
                                <th class="area-col">Marca</th>
                                <th class="usuario-col">Modelo</th>
                                <th class="descripcion-col">Cantidad</th>
                                <th class="proceso-col">UDM</th>
                                <th class="small-col">Proveedor</th>
                                <th class="oc-col">OC</th>
                                <th class="remove-btn"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><input required type="text" class="form-control" name="descripcion[]" placeholder="Descripción"></td>
                                <td><input required type="text" class="form-control" name="marca[]" placeholder="Marca"></td>
                                <td><input required type="text" class="form-control" name="modelo[]" placeholder="Modelo"></td>
                                <td><input required type="number" class="form-control" name="cantidad[]" placeholder="Cantidad"></td>
                                <td><input required type="text" class="form-control" name="udm[]" placeholder="UDM"></td>
                                <td><input required type="text" class="form-control" name="proveedor[]" placeholder="Proveedor"></td>
                                <td><input required type="text" class="form-control" name="oc[]" placeholder="OC"></td>
                                <td><button type="button" class="btn btn-warning">Eliminar</button></td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Botones para añadir ítems -->
                    <div class="d-flex mb-3">
                        <button type="button" class="btn btn-warning me-2" id="addRowBtn">Añadir</button>
                    </div>

                    <!-- Botones para enviar el formulario -->
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-warning">Generar</button>
                        <a href="{{ url_for('requesiciones') }}" class="btn btn-warning">Volver</a>
                    </div>
                </div>

                <!-- Contenedor de información adicional / estado actual -->
                <div class="info-container bg-secondary bg-gradient bg-opacity-50 p-3">
                    <h3>Acciones / estado actual</h3>
                    <div class="mb-3">
                        <label for="cotizacion" class="form-label">Cotización:</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="cotizacion" name="cotizacion" placeholder="Cotización" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="autorizacion" class="form-label">Autorización:</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="autorizacion" name="autorizacion" placeholder="Autorización" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="oc" class="form-label">OC:</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="oc" name="oc" placeholder="Orden de Compra" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="estado" class="form-label">Estado:</label>
                        <select class="form-select" name="estado">
                            <option selected>Seleccionar</option>
                            <option>Parcial</option>
                            <option>Recibido</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="eta" class="form-label">ETA:</label>
                        <input type="date" class="form-control" id="eta" name="eta" required>
                    </div>
                    <div class="mb-3">
                        <label for="facturas" class="form-label">Facturas:</label>
                        <input type="text" class="form-control" id="facturas" name="facturas" placeholder="Facturas" required>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQ+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>

    <script>
        // Añadir una nueva fila a la tabla
        document.getElementById("addRowBtn").addEventListener("click", function () {
            const table = document.getElementById("requisicionTable").getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            const columns = ['descripcion', 'marca', 'modelo', 'cantidad', 'udm', 'proveedor', 'oc'];
        
            newRow.insertCell(0).innerHTML = table.rows.length;
        
            columns.forEach(function (name) {
                const cell = newRow.insertCell();
                cell.innerHTML = `<input required type="text" class="form-control" name="${name}[]" placeholder="${name.charAt(0).toUpperCase() + name.slice(1)}">`;
            });
        
            // Agregar botón de eliminar en la nueva fila
            const removeCell = newRow.insertCell();
            removeCell.innerHTML = `<button type="button" class="btn btn-warning removeRowBtn">Eliminar</button>`;
            addRemoveRowEvent(removeCell.querySelector('.removeRowBtn'));
        });
        
        // Añadir evento para eliminar una fila
        function addRemoveRowEvent(button) {
            button.addEventListener('click', function () {
                const row = button.closest('tr');
                row.remove();
                updateLineNumbers();
            });
        }

        // Actualizar números de línea después de eliminar una fila
        function updateLineNumbers() {
            const rows = document.querySelectorAll("#requisicionTable tbody tr");
            rows.forEach((row, index) => {
                row.cells[0].innerText = index + 1;
            });
        }

        document.querySelectorAll('.removeRowBtn').forEach(function (button) {
            addRemoveRowEvent(button);
        });
    </script>
</body>

</html>
